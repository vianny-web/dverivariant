# Двери вариант

## Обзор

REST API сервис магазина Dveri variant

> Примечание: все пароли и многие функции были изменены для деплоя на сервер

## Содержание
- [Архитектура проекта](#архитектура-проекта)
    - [Используемые технологии](#используемые-технологии)
    - [Архитектурный стиль](#архитектурный-стиль)
- [Возможности API (Endpoints)](#возможности-api-endpoints)
    - [Зарегистрироваться](#зарегистрироваться)
    - [Войти](#войти)
    - [Создать товар](#создать-товар)
    - [Изменить товар](#изменить-товар)
    - [Удалить товар](#удалить-товар)
    - [Получить все товары по категории](#получить-все-товары)
    - [Получить товар](#получить-товар)
    - [Получить картинку товара](#получить-картинку-товара)
- [Серверная установка и конфигурация](#серверная-установка-и-конфигурация)
    - [Выбор сервера](#выбор-сервера)
    - [Базовая настройка сервера](#базовая-настройка-сервера)
    - [SSL сертификат](#ssl-сертификат)
- [Frontend часть сайта](#frontend-часть-сайта)

## Архитектура проекта
В этом разделе показана общая структура API.

---

### Используемые технологии

![Architecture api](github/img/architecture.jpg)

- **Gradle** для управления проектами на Java, который позволяет легко управлять зависимостями, компилировать и собирать проекты
- **Spring**
    - Spring Boot для разработки приложений на Java, который упрощает процесс создания самостоятельных, продуктивных и гибких приложений.
    - Spring Data (JPA) для взаимодействия c базой данных.
    - Spring Security для аутентификации и авторизации пользователей через JWT-токен.
- **Postgresql** - для хранения пользовательских данных.
- **MongoDB** - для хранения товаров.
- **Minio** - S3 хранилище для картинок товаров (В Minio нет папок. Все в minio является «объектом». Папки создаются на основе /косой черты - в имени файла).
- **Redis** - для кэширования данных из MongoDB и Minio.

### Архитектурный стиль

В данном проекте используется архитектурный стиль **REST API**, основанный на принципах REST.

Это означает, что взаимодействие между клиентом и сервером осуществляется через HTTP протокол с использованием стандартных методов запросов (GET, POST, PUT, DELETE) к определенным ресурсам (URL).

Клиенты могут отправлять запросы на сервер для выполнения операций над ресурсами, а сервер отвечает на эти запросы соответствующими HTTP статусами и данными в формате JSON.

---

## Возможности API (Endpoints)
В этом разделе показаны функции API.

> Поскольку существует множество категорий товаров (принцип для всех одинаковый), я остановлюсь на описании лишь одной - "Межкомнатные двери".

---

### Зарегистрироваться
- Метод: POST
- URL: `/authAccount/signUp`
- Описание: Регистрирует нового админа в системе
- Параметры запроса:
```json
{
    "login": "vianny",
    "password": "qwerty12345"
}
```
- Ответ:
```json
{
    "httpStatus": "CREATED",
    "message": "Successfully",
    "dateTime": "2024.03.30 20:56:24"
}
```

### Войти

- Метод: POST
- URL: `/authAccount/signIn`
- Описание: Аутентифицирует админа и возвращает токен доступа
- Параметры запроса:
```json
{
    "login": "vianny",
    "password": "qwerty12345"
}
```
- Ответ:
```json
{
    "httpStatus": "OK",
    "jwtToken": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ2aWFubnkiLCJpYXQiOjE3MTE4MjI2NTQsImV4cCI6MTcxMTg0MjY1NH0.vup6-lpps3yE-Hm9k_i0IpILfOLSy1fnBQlxap4yUU8",
    "dateTime": "2024-03-30T21:17:34.640429459"
}
```

### Создать товар

> Свойства товара строго типизированы и представлены в виде перечислений (ENUM).

- Метод: POST
- URL: `/adm/interior-door`
- Описание: Создает товар в системе
- Параметры запроса:
    - Authorization: `Bearer eyJhbGciOiJIUzI1NiJ9...`
    - imageFile: byte[]
    - article: 2934
    - name: название двери
    - description: описание двери
    - price: 10000 (в копейках)
    - material: NATURAL_VENEER
    - glazing: WITH_MIRROR
    - modification: STANDARD_OPENING
    - construction: BAGET
    - manufacturer: QUEST_DOORS
- Ответ:
```json
{
  "httpStatus": "CREATED",
  "message": "Товар был успешно добавлен"
}
```
> Ответ, если товар с таким артикулом уже существует:
```json
{
  "status": "CONFLICT",
  "message": "Выберите другой артикул"
}
```


### Изменить товар

- Метод: PUT
- URL: `/adm/interior-door?id={id}`
- Описание: Обновляет товар в системе
- Параметры запроса:
    - Authorization: `Bearer eyJhbGciOiJIUzI1NiJ9...`
    - id: id товара
    - свойства товара (такие же как и при создании)
- Ответ:
```json
{
  "httpStatus": "OK",
  "message": "Товар успешно обновлен"
}
```

### Удалить товар

- Метод: DELETE
- URL: `/adm/interior-door?id={id}`
- Описание: Удаляет товар в системе
- Параметры запроса:
    - Authorization: `Bearer eyJhbGciOiJIUzI1NiJ9...`
    - id: id товара
- Ответ:
```json
{
  "httpStatus": "OK",
  "message": "Товар успешно удален"
}
```

### Получить все товары

- Метод: GET
- URL: `/catalog/category/interior-door/all`
- Описание: Выводит все товары по категории
- Ответ:
```json
{
  "httpStatus": "FOUND",
  "products": [
    {
      "id": "666d60e2e4a62a670b8aa66c",
      "article": "1000001",
      "name": "название двери",
      "description": "описание двери",
      "price": 100000,
      "pathImage": "INTERIOR_DOOR/9cb4f4b8-b684-4068-a91f-c6dd43060729",
      "details": {
        "material": "Массив",
        "construction": "Щитовая",
        "glazing": "Без стекла (глухое)",
        "modification": "Стандартное открывание",
        "manufacturer": "Optima Porte"
      }
    }
  ]
}
```

### Получить товар

- Метод: GET
- URL: `/catalog/product?id={id}&type={type}`
- Описание: Выводит товар по id
- Параметры запроса:
    - id: id товара
    - type: категория товара
- Ответ:
```json
{
  "httpStatus": "FOUND",
  "product": {
    "id": "667032d02ef90c57db39aaca",
    "article": "222222",
    "name": "run test 2",
    "description": ".....",
    "price": 20,
    "pathImage": "INTERIOR_DOOR/22373133-dc92-41c0-a741-0a94f94e2eb4",
    "typeProduct": "INTERIOR_DOOR",
    "details": {
      "material": "Натуральный шпон",
      "construction": "Багетные",
      "glazing": "С зеркалом",
      "modification": "Стандартное открывание",
      "manufacturer": "QuestDoors"
    }
  }
}
```

### Получить картинку товара

- Метод: GET
- URL: `/catalog/image/?pathImage=`
- Описание: Выводит картинку товара (загружает)
- Параметры запроса:
    - pathImage: путь картинки
- Ответ:
```json
byte[]
```

## Серверная установка и конфигурация
В этом разделе описано все про установку и конфигурацию сервера, включая информацию о том, какой сервер был использован, его конфигурации, базовые настройки, а также про SSL-сертификат.

---

### Выбор сервера

Мною был выбран VPS-сервер от **my.nuxt.cloud**.

С такой конфигурацией:
- 1 ядро
- 2 гб RAM
- 30 гб хранилища

### Базовая настройка сервера

Была произведена полная настройка сервера, а именно:
- Создание отдельного пользователя
- Создание и настройка SSH ключа:
    - Вход только по ключу
    - Запрет входа через root
- Создание файла-подкачки (т.к мало RAM)
- Создание SSL сертификата (подробнее см. [SSL сертификат](#ssl-сертификат))
- Закрытие неиспользованных портов

### SSL сертификат

Для обеспечения безопасного соединения (HTTPS) был установлен SSL-сертификат, который обеспечивает шифрование передаваемых данных между сервером и пользователем. 

Это гарантирует конфиденциальность и целостность информации, защищая её от перехвата и несанкционированного доступа.

> Примечание: для установки сертификата требуется зарегистрировать домен и обновлять его раз в год

## Frontend часть сайта

Frontend часть сайта была написана моим коллегой на React + Next JS
